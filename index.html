<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Password Strength Tester ‚Ä¢ Neon</title>
<style>

  :root{
    --bg0:#0a0f1f; --bg1:#121735; --bg2:#0b223a; --grid:#1b2c4d;
    --text:#e8f0ff; --muted:#98a2b3; --accent:#47f7c7; --accent-2:#8b5cf6;
    --accent-3:#22d3ee; --gold:#ffd166; --good:#3cf59f; --warn:#f4b740; --bad:#ff6b6b;
    --panel: rgba(15,22,46,.55); --ring: rgba(137,180,255,.25); --card: rgba(17,25,55,.6); --white:#ffffff;
  }
  *{box-sizing:border-box}

  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 15% -10%, #1b2b64 0%, transparent 60%),
      radial-gradient(900px 500px at 90% 10%, #0f6b6b 0%, transparent 60%),
      radial-gradient(900px 700px at 20% 100%, #461a7c 0%, transparent 60%),
      linear-gradient(120deg, var(--bg0), var(--bg1) 40%, var(--bg2));
    overflow-x:hidden;
  }
  .neon-swirl{position:fixed; inset:-10%; pointer-events:none; z-index:-2;
    background: conic-gradient(from 0deg at 60% 40%, rgba(71,247,199,.25), rgba(34,211,238,.12), rgba(139,92,246,.2), rgba(255,105,180,.12), rgba(71,247,199,.25));
    filter: blur(80px) saturate(1.2); animation: swirl 18s linear infinite;}
  @keyframes swirl { to { transform: rotate(360deg) } }
  .gridfx{position:fixed; inset:0; z-index:-1; pointer-events:none;
    background:
      linear-gradient(0deg, transparent 24%, var(--grid) 25%, var(--grid) 26%, transparent 27%),
      linear-gradient(90deg, transparent 24%, var(--grid) 25%, var(--grid) 26%, transparent 27%);
    background-size: 40px 40px; opacity:.25;
    mask-image: radial-gradient(1200px 900px at 50% 40%, black 60%, transparent 100%);
  }
  .wrap{max-width:1100px; margin:48px auto; padding:0 18px}
  header{text-align:center; margin-bottom:18px}
  h1{font-size:2.15rem; margin:.25rem 0; letter-spacing:.3px}
  .subtitle{color:var(--gold); font-weight:800; letter-spacing:.3px}
  .disclaimer{color:var(--muted); font-size:.95rem; background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
    border:1px solid var(--ring); padding:10px 12px; border-radius:12px; backdrop-filter: blur(8px)}
  .badge{
    display:inline-flex; align-items:center; gap:10px; margin:8px 0 12px; padding:8px 14px; border-radius:999px;
    border:1px solid var(--ring); background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    box-shadow: 0 0 25px rgba(71,247,199,.15), inset 0 0 18px rgba(139,92,246,.08); font-weight:800
  }
  .badge .dot{width:10px;height:10px;border-radius:999px;background:var(--accent); box-shadow:0 0 12px var(--accent)}
  .panel{background: var(--panel); border:1px solid var(--ring); border-radius:18px; padding:18px;
    box-shadow: 0 20px 70px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03); backdrop-filter: blur(10px);}
  .card{background: var(--card); border:1px solid var(--ring); border-radius:16px; padding:14px;
    box-shadow: 0 12px 50px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.03); backdrop-filter: blur(8px);}
  .card h3{margin:0 0 8px; font-size:1.1rem}
  .row{display:grid; grid-template-columns:1fr; gap:16px}
  @media(min-width:900px){ .row{ grid-template-columns:1.3fr .9fr } }
  label{display:block; font-weight:900; margin-bottom:8px; letter-spacing:.2px}
  input[type="text"], input[type="email"]{
    width:100%; padding:14px 16px; border-radius:14px; border:1px solid var(--ring);
    background: rgba(8,12,30,.6); color:var(--white); font-size:1.05rem; outline:none;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.02), 0 0 0 0 rgba(71,247,199,.0);
    transition: box-shadow .18s ease, border-color .18s ease;
  }
  input:focus{ border-color: rgba(71,247,199,.7); box-shadow: 0 0 0 8px rgba(71,247,199,.08), 0 0 0 1px rgba(71,247,199,.4) inset; }
  input::placeholder{color:#8ea4c2}
  .hint{color:var(--muted); font-size:.9rem; margin-top:6px}

  .out{display:grid; gap:12px}
  .kpi{display:grid; grid-template-columns:160px 1fr auto; align-items:center; gap:12px;
    background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    border:1px solid var(--ring); padding:12px; border-radius:14px}
  .kpi .name{color:#a9b8d9; font-size:.95rem; font-weight:700}
  .kpi .bar{height:12px; background:rgba(8,12,30,.7); border:1px solid var(--ring); border-radius:999px; overflow:hidden}
  .kpi .bar>i{display:block; height:100%; width:0%}
  .kpi .val{font-variant-numeric:tabular-nums; font-weight:800}

  .score{display:grid; grid-template-columns:repeat(5,1fr); gap:6px; margin-top:10px}
  .score div{height:12px;border-radius:6px;background:rgba(8,12,30,.7);border:1px solid var(--ring)}
  .score div.on.bad{ background: linear-gradient(90deg, #ff6b6b, #f87171) }
  .score div.on.mid{ background: linear-gradient(90deg, #f59e0b, #f4b740) }
  .score div.on.good{ background: linear-gradient(90deg, #3cf59f, #47f7c7) }
  .strength-row{display:flex;align-items:center;gap:10px;margin-top:8px}
  .face{font-size:1.5rem}
  .tag{display:inline-block; padding:6px 10px; border-radius:999px; font-size:.9rem; font-weight:800;
    border:1px solid var(--ring); color:#cfe9ff; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));}

  .policy{list-style:none;margin:0;padding-left:0;display:grid;gap:6px}
  .policy li{display:flex; align-items:flex-start; gap:10px;
    background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    border:1px solid var(--ring); border-radius:12px; padding:10px 12px}
  .policy .label{flex:1}
  .ok{color:var(--good); font-weight:900; text-shadow:0 0 12px rgba(60,245,159,.35)}
  .fail{color:var(--bad); font-weight:900; text-shadow:0 0 12px rgba(255,107,107,.25)}
  .badge#policyBadge{ border-image: conic-gradient(from 0deg, var(--accent), var(--accent-3), var(--accent-2), var(--accent)) 1; }

  .btn{
    position:relative; background: linear-gradient(90deg, var(--accent-2), var(--accent-3));
    color:#061222; border:0; padding:12px 14px; border-radius:12px; font-weight:900; cursor:pointer;
    box-shadow: 0 12px 30px rgba(34,211,238,.18), 0 8px 24px rgba(139,92,246,.18); overflow:hidden;
  }
  .btn.secondary{ background:linear-gradient(90deg, #1f2a44, #17223b); color:#e2eeff; box-shadow:none; }
  .inline{display:inline-flex;gap:10px;align-items:center;flex-wrap:wrap}
  .tips ul{margin:0; padding-left:18px}
  .footer{color:var(--muted); font-size:.85rem; text-align:center; margin-top:18px}

  #confetti{position:fixed; inset:0; pointer-events:none}

  .shake { animation: shake .32s ease-in-out 1; }
  @keyframes shake {
    0%{transform:translateX(0)}
    25%{transform:translateX(-8px)}
    50%{transform:translateX(8px)}
    75%{transform:translateX(-5px)}
    100%{transform:translateX(0)}
  }

  .hidden { display:none }
</style>
</head>
<body>
<div class="neon-swirl"></div>
<div class="gridfx"></div>
<canvas id="confetti"></canvas>

<div class="wrap" id="wrap">
  <header>
    <h1>Password Strength Tester</h1>
    <div class="subtitle">Be a Password Pro!</div>
    <div class="badge"><span class="dot"></span> ü¶Å Saint Leo Cyber ‚Ä¢ Be safer online</div>
    <p class="disclaimer">Use a sample password, not a real one. Runs only in this browser, nothing is uploaded or stored.</p>
  </header>

  <div class="panel">
    <div class="row">
      <div>
        <label for="pw">Your sample password</label>
        <input id="pw" type="text" inputmode="text" placeholder="Try 4‚Äì6 words + symbol + number (e.g., globe-Mint-sunset_37)" autocomplete="off" spellcheck="false" />
        <div class="hint">Rules: 12+ characters; include lowercase + UPPERCASE + number; allowed symbols: ! # $ ^ * - _ . ,</div>

        <div class="inline" style="margin-top:10px; gap:12px">
          <button id="testBtn" class="btn">Test Password</button>
          <button id="gen" class="btn secondary">Generate sample passphrase</button>
          <span class="tag" id="generated"></span>
          <span class="hint" id="dirtyHint" style="display:none">Edited‚Äîpress ‚ÄúTest Password‚Äù again</span>
        </div>

        <div class="score hidden" id="score"><div></div><div></div><div></div><div></div><div></div></div>
        <div class="strength-row hidden" id="strengthRow">
          <div class="face" id="face">üò¨</div>
          <div class="tag" id="strengthLabel">Very Weak</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Extra checks (optional)</h3>
          <div class="row" style="grid-template-columns:1fr 1fr">
            <div>
              <label for="username">Username</label>
              <input id="username" type="text" placeholder="e.g., lionstudent" autocomplete="off" />
            </div>
            <div>
              <label for="pi">Personal info to avoid (comma separated)</label>
              <input id="pi" type="text" placeholder="e.g., first name, last name, 05212001" autocomplete="off" />
            </div>
            <div>
              <label for="prev1">Previous password #1</label>
              <input id="prev1" type="text" placeholder="sample previous 1" autocomplete="off" />
            </div>
            <div>
              <label for="prev2">Previous password #2</label>
              <input id="prev2" type="text" placeholder="sample previous 2" autocomplete="off" />
            </div>
          </div>
          <div class="hint">Blocks username pieces, common dates, and exact match with last two.</div>
        </div>
      </div>

      <div class="out">
        <div class="kpi hidden" id="lenKPI">
          <div class="name">Length</div>
          <div class="bar"><i id="lenBar"></i></div>
          <div class="val" id="lenVal">0</div>
        </div>
        <div class="kpi hidden" id="entKPI">
          <div class="name">Strength (bits)</div>
          <div class="bar"><i id="entBar"></i></div>
          <div class="val" id="entVal">0</div>
        </div>
        <div class="kpi hidden" id="spaceKPI">
          <div class="name">Number of combos</div>
          <div class="bar"><i id="spaceBar"></i></div>
          <div class="val" id="spaceVal">1</div>
        </div>
      </div>
    </div>

    <div class="card hidden" id="policyCard" style="margin-top:14px">
      <h3>Policy check</h3>
      <ul id="policyList" class="policy"></ul>
      <div class="badge" id="policyBadge">Press ‚ÄúTest Password‚Äù to see results</div>
    </div>

    <div class="row" style="margin-top:14px">
      <div class="card hidden" id="timesCard">
        <h3>How long to guess it</h3>
        <div id="times"></div>
      </div>
      <div class="card tips">
        <h3>Tips & notes</h3>
        <ul id="tipsList">
          <li>Press <strong>Test Password</strong> to see tips or praise.</li>
        </ul>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h3>Share results</h3>
      <div class="row" style="grid-template-columns:1fr 1fr">
        <div>
          <label for="emailTo">Send to (optional)</label>
          <input id="emailTo" type="email" placeholder="your.email@example.com" />
        </div>
        <div style="display:flex;align-items:center;gap:12px; padding-top:28px">
          <label class="inline" style="gap:6px"><input type="checkbox" id="includePw" checked /> Include sample password in summary</label>
        </div>
      </div>
      <div class="inline" style="margin-top:10px">
        <button id="emailSummary" class="btn">Email me</button>
      </div>
    </div>

    <div class="footer">Estimates are optimistic for attackers. Real‚Äëworld cracking can be faster if your sample resembles common patterns.</div>
  </div>
</div>

<audio id="win-sound" src="sounds/win.wav" preload="auto"></audio>
<audio id="fail-sound" src="sounds/fail.mp3" preload="auto"></audio>

<script>

  const ALLOWED_SYMBOLS = "!#$^*-_.,";
  const ATTACKS = [
    { name:"Slow online",  rate:100/3600, hint:"~100 tries per hour" },
    { name:"Fast online",  rate:10,       hint:"~10 per second" },
    { name:"Slow offline", rate:1e6,      hint:"~1M per second" },
    { name:"GPU rig",      rate:1e11,     hint:"~100B per second" },
    { name:"Huge rig",     rate:1e13,     hint:"~10T per second" },
  ];

  const log2 = x => Math.log(x)/Math.log(2);
  function fmtInt(n){ if(n<1e3) return Math.floor(n).toString(); const u=[[1e12,'T'],[1e9,'B'],[1e6,'M'],[1e3,'K']]; for(const [v,s] of u) if(n>=v) return (n/v).toFixed(2).replace(/\.00$/,'')+s; return n.toFixed(0) }
  function fmtDuration(sec){
    if(sec<1) return "< 1 sec";
    const y=31557600, u=[[y*1e9,'billion years'],[y*1e6,'million years'],[y*1e3,'thousand years'],[y,'years'],[86400,'days'],[3600,'hours'],[60,'minutes'],[1,'seconds']];
    for(const [k,n] of u) if(sec>=k) return (sec/k).toFixed(2).replace(/\.00$/,'')+" "+n;
    return sec.toFixed(2)+" sec";
  }
  const byId = id => document.getElementById(id);
  const setText = (id,txt)=>{ const el=byId(id); if(el) el.textContent=txt; }
  const mk = (tag,cls,txt)=>{ const n=document.createElement(tag); if(cls) n.className=cls; if(txt!=null) n.textContent=txt; return n; }
  const setBar = (id,pct,color)=>{ const el=byId(id); if(el){ el.style.width=pct+"%"; el.style.background=color; } }
  function show(el){ el.classList.remove("hidden"); }
  function hide(el){ el.classList.add("hidden"); }

  function playWinSound(){ const a=byId("win-sound"); if(a){ a.currentTime=0; a.play().catch(()=>{});} }
  function playFailSound(){ const a=byId("fail-sound"); if(a){ a.currentTime=0; a.play().catch(()=>{});} }

  const hasTripleRepeat = s => [...s].some((_,i)=>i>=2 && s[i]===s[i-1] && s[i-1]===s[i-2]);
  function charsetSize(s){
    let size=0; const lower=/[a-z]/.test(s), upper=/[A-Z]/.test(s), digit=/[0-9]/.test(s);
    const sym=[...s].some(ch=>ALLOWED_SYMBOLS.includes(ch));
    if(lower) size+=26; if(upper) size+=26; if(digit) size+=10; if(sym) size+=ALLOWED_SYMBOLS.length;
    if(s.length && size===0) size=26;
    return {size,lower,upper,digit,sym};
  }
  function penalty(s){
    let p=0; const a=s.toLowerCase(), bad=["1234","abcd","qwer","asdf","password","letmein","welcome","iloveyou","dragon","monkey","football"];
    for(const q of bad) if(a.includes(q)) p+=10;
    if(hasTripleRepeat(s)) p+=8;
    return p;
  }
  function entropy(pw){
    const n=pw.length; if(!n) return {bits:0,guesses:1,space:1,cs:charsetSize(pw)};
    const cs=charsetSize(pw); let bits=n*log2(Math.max(2,cs.size)); bits=Math.max(0,bits-penalty(pw));
    const guesses=Math.pow(2,bits); const space=Math.pow(Math.max(2,cs.size),n);
    return {bits,guesses,space,cs};
  }
  const tri = s => {const t=[];const a=s.toLowerCase();for(let i=0;i<=a.length-3;i++) t.push(a.slice(i,i+3));return t};
  function overlap(pw,u){
    if(!u) return null; const a=pw.toLowerCase();
    const tokens=u.toLowerCase().split(/[^a-z0-9]+/).filter(x=>x.length>=3);
    for(const tok of tokens) if(a.includes(tok)) return tok;
    for(const t of tri(u)) if(a.includes(t)) return t;
    return null;
  }
  function personalHit(pw, terms){
    if(!terms) return null; const a=pw.toLowerCase();
    const arr=terms.split(',').map(s=>s.trim().toLowerCase()).filter(s=>s.length>=3);
    for(const t of arr) if(a.includes(t)) return t;
    return null;
  }
  function looksLikeBirthday(pw){
    const runs=[]; let cur='';
    for(const ch of pw){ if(ch>='0'&&ch<='9'){ cur+=ch } else { if(cur.length>=6) runs.push(cur); cur=''; } }
    if(cur.length>=6) runs.push(cur);
    const ok=(m,d)=> m>=1&&m<=12&&d>=1&&d<=31;
    for(const r of runs){
      for(const len of [6,8]){
        if(r.length>=len) for(let i=0;i<=r.length-len;i++){
          const seg=r.slice(i,i+len);
          if(len===6){ const m=+seg.slice(0,2), d=+seg.slice(2,4); if(ok(m,d)||ok(d,m)) return true; }
          if(len===8){ const m=+seg.slice(0,2), d=+seg.slice(2,4); if(ok(m,d)||ok(d,m)) return true; }
        }
      }
    }
    return false;
  }
  function validate(pw,{username,prev1,prev2,personal}){
    const rules=[];
    const lenOk=pw.length>=12; rules.push({ok:lenOk, label:"Length 12+", detail: lenOk?`${pw.length} chars`:`need 12+, you have ${pw.length}`});
    const lc=/[a-z]/.test(pw), uc=/[A-Z]/.test(pw), dg=/[0-9]/.test(pw);
    const classesOk=lc&&uc&&dg; rules.push({ok:classesOk, label:"Lower + Upper + Number", detail:`lower ${lc?'‚úì':'‚úï'}, upper ${uc?'‚úì':'‚úï'}, number ${dg?'‚úì':'‚úï'}`});
    const charsOk=[...pw].every(ch=>{const c=ch.charCodeAt(0); const letter=(c>=65&&c<=90)||(c>=97&&c<=122); const digit=(c>=48&&c<=57); return letter||digit||ALLOWED_SYMBOLS.includes(ch)});
    rules.push({ok:charsOk, label:"Only allowed symbols", detail: charsOk?"OK":`Use letters, numbers, and ${ALLOWED_SYMBOLS}`});
    let userOk=true, hit=null; if(username){ hit=overlap(pw,username); userOk=(hit===null) }
    rules.push({ok:userOk, label:"No part of username", detail: username?(userOk?"OK":`found "${hit}"`):"not checked"});
    let prevOk=true, prevDetail="OK"; if(prev1){ if(pw===prev1){ prevOk=false; prevDetail="matches previous #1" } } if(prev2&&prevOk){ if(pw===prev2){ prevOk=false; prevDetail="matches previous #2" } }
    rules.push({ok:prevOk, label:"Not last 2 passwords", detail:(prev1||prev2)?prevDetail:"not checked"});
    let piOk=true, pi=null; if(personal){ pi=personalHit(pw,personal); piOk=(pi===null) }
    rules.push({ok:piOk, label:"No personal info", detail: personal?(piOk?"OK":`found "${pi}"`):"not checked"});
    const bdayOk=!looksLikeBirthday(pw); rules.push({ok:bdayOk, label:"No birthdays or dates", detail:bdayOk?"OK":"looks like a date"});
    return { rules, pass: rules.every(r=>r.ok) };
  }

  const faces=["üò¨","üòê","üôÇ","üí™","ü¶Å"];
  const labels=["Very weak","Weak","Okay","Strong","Beast"];
  function buildTips(res, bits, len){
    if(res.pass){
      const praise = [];
      if(len>=16) praise.push("Nice long passphrase!");
      if(bits>=60) praise.push("Great strength score.");
      praise.push(...[
        "Locked down. Proud of you.",
        "Strong work! This is solid.",
        "Beast mode. Nicely done.",
        "Great job! This is hard to guess."
      ]);
      return praise.slice(0,3);
    }
    const tips=[];
    for(const r of res.rules){
      if(r.ok) continue;
      switch(r.label){
        case "Length 12+": tips.push("Add more words to make it longer."); break;
        case "Lower + Upper + Number": tips.push("Use at least one lowercase, one UPPERCASE, and one number."); break;
        case "Only allowed symbols": tips.push(`Use only these: ${ALLOWED_SYMBOLS}`); break;
        case "No part of username": tips.push("Remove anything that matches your username."); break;
        case "Not last 2 passwords": tips.push("Do not reuse your last two passwords."); break;
        case "No personal info": tips.push("Remove names, birthdays, or personal details."); break;
        case "No birthdays or dates": tips.push("Avoid dates like MMDDYY or YYYYMMDD."); break;
      }
    }
    if(len<14) tips.push("Try 4‚Äì6 random words + a symbol + a number.");
    if(bits<40) tips.push("Make it longer to boost strength.");
    const seen=new Set(); const out=[];
    for(const t of tips){ if(!seen.has(t)){ seen.add(t); out.push(t); if(out.length>=4) break; } }
    return out;
  }

  const cf = {ctx:null,parts:[],w:0,h:0};
  function initConfetti(){
    const c = byId("confetti"); const dpr = Math.max(1, window.devicePixelRatio||1);
    cf.w = c.width = innerWidth * dpr; cf.h = c.height = innerHeight * dpr; c.style.width="100%"; c.style.height="100%";
    cf.ctx = c.getContext("2d"); cf.ctx.scale(dpr,dpr);
  }
  window.addEventListener("resize", initConfetti);
  function celebrate(){
    if(!cf.ctx) initConfetti();
    const colors = ["#47f7c7", "#22d3ee", "#8b5cf6", "#ffd166", "#7cc6fe"];
    for(let i=0;i<160;i++){
      cf.parts.push({
        x: Math.random()*innerWidth, y: -10, r: 4+Math.random()*6,
        vx: -2.2+Math.random()*4.4, vy: 2.2+Math.random()*3.2,
        rot: Math.random()*6.28, vr: -0.12+Math.random()*0.24,
        color: colors[Math.floor(Math.random()*colors.length)], life: 0, max: 220+Math.random()*120
      });
    }
    if(!celebrate._running){ celebrate._running=true; requestAnimationFrame(loop); }
  }
  function loop(){
    const ctx = cf.ctx; if(!ctx){celebrate._running=false; return;}
    ctx.clearRect(0,0,innerWidth,innerHeight);
    cf.parts.forEach(p=>{
      p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.life++;
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
      ctx.fillStyle=p.color; ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
      ctx.restore();
    });
    cf.parts = cf.parts.filter(p=>p.life<p.max && p.y<innerHeight+20);
    if(cf.parts.length){ requestAnimationFrame(loop); } else { celebrate._running=false; }
  }

  function renderAll(){
    const pw = byId("pw").value||"";
    const username = byId("username")?.value||"";
    const prev1 = byId("prev1")?.value||"";
    const prev2 = byId("prev2")?.value||"";
    const personal = byId("pi")?.value||"";

    const {bits,guesses,space} = entropy(pw);

    [ "score","strengthRow","lenKPI","entKPI","spaceKPI","policyCard","timesCard" ].forEach(id=>show(byId(id)));

    const len = pw.length, lenPct = Math.min(100,(len/24)*100);
    setBar("lenBar", lenPct, len<12? "var(--bad)" : len<16? "var(--warn)" : "var(--good)");
    setText("lenVal", String(len));

    const entPct = Math.min(100,(bits/80)*100);
    setBar("entBar", entPct, bits<40? "var(--bad)" : bits<60? "var(--warn)" : "var(--good)");
    setText("entVal", bits.toFixed(1));

    const spPct = Math.min(100, log2(space+1)/80*100);
    setBar("spaceBar", spPct, "var(--accent)");
    setText("spaceVal", space>1e6? `${fmtInt(space)} combos` : space.toLocaleString()+" combos");

    const score = bits<28?0:bits<36?1:bits<45?2:bits<60?3:4;
    document.querySelectorAll("#score div").forEach((b,i)=>{ b.className=""; if(i<=score-1){ b.classList.add("on", score<=1?"bad": score===2?"mid":"good"); } });
    setText("face", faces[score]||"üò¨"); setText("strengthLabel", labels[score]||"Very weak");

    const avg = Math.max(1, guesses/2); const container = byId("times"); container.innerHTML="";
    ATTACKS.map(a=>({name:a.name,hint:a.hint,seconds:avg/a.rate})).forEach(t=>{
      const div = mk("div","kpi");
      div.append(mk("div","name",`${t.name} (${t.hint})`));
      const bar = mk("div","bar"); const fill = mk("i");
      const scaled = Math.min(1, Math.log10(t.seconds+1)/12);
      fill.style.width = (scaled*100)+"%";
      fill.style.background = t.seconds<3600? "linear-gradient(90deg,#ff6b6b,#f87171)" :
                              t.seconds<86400*30? "linear-gradient(90deg,#f59e0b,#f4b740)" :
                              "linear-gradient(90deg,#3cf59f,#47f7c7)";
      bar.appendChild(fill);
      div.append(bar, mk("div","val",fmtDuration(t.seconds)));
      container.append(div);
    });

    const res = validate(pw,{username,prev1,prev2,personal});
    renderPolicy(res);

    const tips = buildTips(res, bits, len);
    const tipsList = byId("tipsList"); tipsList.innerHTML="";
    tips.forEach(t => tipsList.appendChild(mk("li","",t)));

    const panel = document.querySelector(".panel");
    if(res.pass){
      playWinSound();
      celebrate();
      panel.classList.remove("shake");
      byId("policyBadge").style.color = "var(--good)";
    }else{
      playFailSound();

      panel.classList.remove("shake"); void panel.offsetWidth; panel.classList.add("shake");
      byId("policyBadge").style.color = "var(--bad)";
    }

    byId("dirtyHint").style.display="none";
  }

  function renderPolicy(res){
    const ul = byId("policyList"); ul.innerHTML="";
    res.rules.forEach(r=>{
      const li = mk("li","",null);
      li.append(mk("span", r.ok?"ok":"fail", r.ok?"‚úì":"‚úï"));
      li.append(mk("span","label", `${r.label} - ${r.detail||""}`));
      ul.append(li);
    });
    const badge = byId("policyBadge");
    badge.textContent = res.pass? "Policy: PASS üéâ" : "Policy: FAIL";
    badge.style.boxShadow = res.pass? "0 0 30px rgba(71,247,199,.25)" : "0 0 20px rgba(255,107,107,.2)";
  }

  function compileSummary(){
    const pw = byId("pw").value||"";
    const includePw = byId("includePw").checked;
    const username = byId("username")?.value||"";
    const prev1 = byId("prev1")?.value||"";
    const prev2 = byId("prev2")?.value||"";
    const personal = byId("pi")?.value||"";
    const ent = entropy(pw), res = validate(pw,{username,prev1,prev2,personal});
    const avg = Math.max(1, ent.guesses/2);
    const offlineFast = avg/1e11, onlineLimited = avg/(100/3600);
    const failed = res.rules.filter(r=>!r.ok).map(r=>r.label).join(", ") || "None";
    let body = "";
    body += "Password Strength Tester (Neon)\n";
    body += "Policy status: " + (res.pass?"PASS":"FAIL") + "\n";
    if(includePw) body += "Sample password: " + pw + "\n";
    body += "Length: " + pw.length + "\n";
    body += "Strength (bits): " + ent.bits.toFixed(1) + "\n";
    body += "GPU guess time (est.): " + fmtDuration(offlineFast) + "\n";
    body += "Slow online guess time (est.): " + fmtDuration(onlineLimited) + "\n";
    body += "Failed rules: " + failed + "\n";
    body += "\nRules: 12+ length; lower + UPPER + number; allowed symbols \""+ALLOWED_SYMBOLS+"\"; no username parts; no birthdays or personal info; not one of last two.\n";
    body += "\nReminder: Use a password manager and enable MFA. This is a sample only.\n";
    return body;
  }
  function openMailDraft(to){
    const subject = "Your Password Tester Results";
    const body = compileSummary();
    const mailto = "mailto:" + encodeURIComponent(to||"") +
      "?subject=" + encodeURIComponent(subject) +
      "&body=" + encodeURIComponent(body);
    window.location.href = mailto;
  }
  async function copySummary(){
    const text = compileSummary();
    try{ await navigator.clipboard.writeText(text); alert("Summary copied to clipboard."); }
    catch(e){
      const ta=document.createElement("textarea"); ta.value=text; document.body.appendChild(ta); ta.select();
      try{ document.execCommand("copy"); alert("Summary copied to clipboard."); }
      finally{ document.body.removeChild(ta); }
    }
  }

 function markDirty(){ byId("dirtyHint").style.display="inline"; }
  byId("testBtn").addEventListener("click", renderAll);
  ["pw","username","prev1","prev2","pi"].forEach(id=>{
    const el = byId(id);
    if (el) el.addEventListener("input", markDirty);
  });

  byId("gen").addEventListener("click", ()=>{
    const WORDS=("acorn,agent,amber,anchor,apple,apricot,archer,atlas,atom,avocado,azure,bamboo,banana,beacon,beaver,berry,bicycle,blaze,blizzard,blossom,bolt,books,brisk,bronze,bubble,cactus,candle,canyon,carrot,castle,cedar,ceramic,chalk,cheddar,cherry,chisel,chrome,cinema,citrus,cloud,clover,coffee,copper,coral,cotton,coyote,cricket,crimson,crystal,custard,daffodil,daisy,delta,desert,diamond,dingo,donut,dragon,drift,ember,falcon,feather,fig,flannel,flute,forest,fox,fuchsia,galaxy,garlic,geyser,ginger,gizmo,glacier,gloss,gnome,goblin,goldfish,gopher,granite,grape,harbor,hazel,hedgehog,helium,heron,honey,horizon,hybrid,indigo,iris,island,ivory,jade,jaguar,jasmine,jelly,jet,jigsaw,joystick,juicy,juniper,kestrel,kettle,kiwi,koala,labyrinth,lake,lantern,lava,lemon,lemur,lichen,lilac,lime,linen,logo,lupin,lynx,magnet,mahogany,maize,mango,maple,marble,marigold,meadow,meteor,mica,mint,mocha,monsoon,moonlight,moss,nectar,neon,nectarine,nickel,nightfall,nova,nugget,oasis,oak,olive,onyx,opal,orbit,origami,otter,owl,oxygen,paint,panda,panther,papaya,pebble,peach,pearl,pecan,peony,pepper,peppermint,periwinkle,permafrost,petal,phoenix,piano,pickle,pineapple,pistachio,plankton,plum,pocket,polar,prism,puddle,pumpkin,quartz,quokka,quill,quince,radish,raptor,reef,river,robin,rocket,rosebud,rouge,ruby,rumble,saffron,sage,sandstone,sardine,sapphire,scallop,scarlet,seafoam,shadow,shamrock,sienna,silk,silver,sizzle,sketch,skylark,slate,smoky,snail,snowflake,soap,solstice,sonar,spark,spice,spinach,spiral,sprout,spruce,starlight,stingray,stone,stream,studio,succulent,sugarplum,sunbeam,sundae,sunrise,supernova,swift,sycamore,tangelo,tangerine,teak,teal,thistle,thunder,tidal,tiger,tin,topaz,tractor,truffle,tulip,tumble,turnip,turtle,twilight,vanilla,vapor,velvet,vertex,violet,walnut,wasabi,waterfall,whale,wheat,willow,windmill,window,winter,wizard,wolf,waffle,woodland,yam,yarrow,yeti,yucca,zephyr,zinc,zircon,zucchini").split(",");
    let words=4+Math.floor(Math.random()*2);
    let picks=[]; for(let i=0;i<words;i++){ picks.push(WORDS[Math.floor(Math.random()*WORDS.length)]); }
    const which=Math.floor(Math.random()*picks.length); picks[which]=picks[which].charAt(0).toUpperCase()+picks[which].slice(1);
    const seps=['-','_','.']; const sep=seps[Math.floor(Math.random()*seps.length)];
    let base=picks.join(sep);
    const num=Math.floor(Math.random()*90)+10;
    const sym=['!','#','$','^','*','-','_','.',','][Math.floor(Math.random()*9)];
    let candidate=base+sym+num;
    if(candidate.length<12){ candidate=base+sym+num+WORDS[Math.floor(Math.random()*WORDS.length)]; }
    byId("generated").textContent=candidate; byId("pw").value=candidate;
    byId("dirtyHint").style.display="inline";
  });

  byId("emailSummary").addEventListener("click", ()=>openMailDraft(byId("emailTo").value.trim()));

  initConfetti();
</script>
</body>
</html>


